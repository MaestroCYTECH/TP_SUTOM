<!DOCTYPE html>
<html lang="fr">

<head>
    <title>SUTOM - Login</title>
    <!-- Jquery -->
    <script src="/jquery-3.6.0.js"></script>

</head>

<body style="font-size:45px; background-color: #62b6e1; color: white;">
    <div class="container" style="text-align: center;">
        <div class="row" style="background-color: #da4646; border-radius: 20px;">
            <h1>LOGIN</h1>
        </div>
        <br/>
        <div class="row">
            <form id="input" onsubmit="return submit_response()">

                <label>Username :</label>
                <input type="text" id="user" placeholder="Username" maxlength="20" style="height:25px; border-radius: 5px;" required> </input><br>
                <br/>
                <label>Password :</label>
                <input type="password" id="password" placeholder = "Password" style="height:25px; border-radius: 5px;" required></input><br>
                <br/>
                <input type="submit" value="Submit" style="width: 20%;height:30px;background-color: #e4ca27;color:white; border-radius: 10px; border: 4px solid #af9b1c">
            </form>
        </div>

        <button onclick="document.location='http://localhost:8080/register'"
            style=" border-radius: 4 px; width: 20%">REGISTER</button>

        <br><br><span id="response" style="color: red"></span>

    </div>
</body>

<div id="includedContent"></div>

<script>

    // Verification si l'utilisateur est connecté
    $.ajax({
        url: "http://localhost:8081/get_user",
        type: "GET",
        success: function (data) {
            if (data.user != null) {
                alert('You are already logged in');
                window.location.href = "http://localhost:8080";
            }
        }
    });

    $(function(){
      $("#includedContent").load("footer.html"); 
    });


    //TODO chiffrement
    // On envoie les données à l'API Auth qui vérifie si ca correspond bien
    function submit_response() {

        // Appel de l'API auth
        $.ajax({
            url: "http://localhost:8081/check_login",
            type: "POST",
            data: {
                'user': $("#user").val(),
                'password': $("#password").val()
            },
            success: function (data) {
                if (data.status == 'fail') {
                    document.getElementById('response').innerHTML = data.err
                    return false;
                }

                console.log("User logged in")
                window.location.href = "http://localhost:8080/motus.html";
            }
        })
        return false;
    }

</script>

</html>